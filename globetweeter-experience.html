<!doctype html>
<html lang="en-US">

<head>
<meta charset="utf-8" />
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<title>cedricpinson - Hunting dog computer programmer</title>
<meta name="description" content="" />
<meta name="Author" content="Ken M. Lai(networktsukkomime.me)" />

<!--[if lt IE 9]>
  <script type="text/javascript" src="http://stepofweb.gweb.io/.templates/IsisOne/HTML/assets/plugins/lt-ie9/html5.js"></script>
  <script type="text/javascript" src="http://stepofweb.gweb.io/.templates/IsisOne/HTML/assets/plugins/lt-ie9/respond.min.js"></script>
  <script type="text/javascript" src="http://stepofweb.gweb.io/.templates/IsisOne/HTML/assets/plugins/lt-ie9/excanvas.compiled.js"></script>
<![endif]--> 

<!-- GOOGLE FONTS -->
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700,800|Dosis:300,400" rel="stylesheet" type="text/css" />

<!-- CORE CSS FRAMEWORK -->
<link href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

<!-- CSS TEMPLATE -->
<link href="./theme/css/reset.css" rel="stylesheet" type="text/css" />
<link href="./theme/css/framework.css" rel="stylesheet" type="text/css" />
<link href="./theme/css/typography.css" rel="stylesheet" type="text/css" />
<link href="./theme/css/layout.css" rel="stylesheet" type="text/css" />

<link href="./theme/css/blog.css" rel="stylesheet" type="text/css" />

<!-- ICONS -->
  <link rel="shortcut icon" href="https://dl.dropboxusercontent.com/u/299446/logo.png" type="image/x-icon" />
  <link rel="icon" href="https://dl.dropboxusercontent.com/u/299446/logo.png" type="image/x-icon" />
  <link rel="shortcut icon" href="https://dl.dropboxusercontent.com/u/299446/logo.png" type="image/x-icon" />

<!-- mobile settings -->
<meta name="viewport" content="width=device-width, maximum-scale=1, initial-scale=1, user-scalable=0" />

<!-- Morenizr -->
<script type="text/javascript" src="./theme/js/modernizr.min.js"></script>

<!-- google authorship -->
</head>

<body>

<!-- Main Nav -->
<header id="header" style="margin-top:0">

  <nav class="navbar navbar-inverse" role="navigation">
    <div class="container">

      <!-- Mobile Menu Button -->
      <button id="mobileMenu" class="fa fa-bars" type="button" data-toggle="collapse" data-target=".navbar-collapse"></button>

      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <a class="navbar-brand scrollTo" href="#home">
          <img src="https://dl.dropboxusercontent.com/u/299446/logo-invert.png" alt="" width="50" height="50" />
          <span class="hidden-xs">cedricpinson</span>
        </a>
      </div>

      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

        <!-- Fullscreen Button - Unavailable for IE -->
        <a href="#" class="btn-fullscreen"><i class="fa fa-external-link"></i></a>

        <ul class="nav navbar-nav navbar-right">
          <!-- If the user wants to make articles the home page then remove blog link, and make about and work links point to old home page. -->
            <li><a href="./index.html#home">Home</a></li>
            <li><a href="./index.html#about">About</a></li>
            <li><a href="./blog.html">Blog</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Links <b class="caret"></b></a>
              <ul class="dropdown-menu" style="background-color:#000">
                <li style="background-color:#000"><a href="http://osgjs.org/" target="_blank">osgjs.org</a></li>
              </ul>
            </li>
        </ul>
      </div>
      <!-- /.navbar-collapse -->

    </div>
  </nav>
</header>
<!-- /Main Nav -->  <section id="blog">
    <article class="container">

      <div class="row">
        <div id="blog_main_area" class="left col-md-9" count=16>
  <!-- article title -->
  <header>
      <h1>GlobeTweeter - Experience</h1>
    <small class="fsize13">
            <a href="./category/blog.html" rel="tag tooltip" class="label label-default light" data-placement="right" data-original-title="15 articles in this category"><i class="fa fa-dot-circle-o"></i> blog</a>
      <a href="./globetweeter-experience.html#disqus_thread" class="scrollTo label label-default light" data-disqus-identifier="globetweeter-experience.html"><i class="fa fa-comment-o"></i> ?? Comments</a>
      <span class="label label-default light">Tue 03 May 2011</span> 
    </small>
  </header>

  <article class='content'>
    <p>Over the last few months, I have been working on a webgl demo for
firefox. The objective was to create a demo to showcase webgl
technology. I am currently working on a 3D framework called
<a href="http://osgjs.org">osgjs</a> so the application uses this javascript
library. osgjs is a javascript implementation of
<a href="http://openscenegraph.org">OpenSceneGraph</a> and helps to manage 3d
scenes and webgl states. You can get more information on the
<a href="http://osgjs.org">website</a>.</p>
<p>We did different experiments before we ended up with globetweeter, I
kept some of them for history :)</p>
<h3>Jurassic Park</h3>
<p>I started off by creating a file system similar to the 3D file system
used in Jurassic Park. I had to figure out the best type of camera that
would be suitable to use with the system.</p>
<p><img alt="" src="media/2011/03/camera-1.jpg" title="Camera" /></p>
<p><img alt="" src="media/2011/03/camera-0.jpg" title="Camera" /></p>
<p>The idea is simple. Let's say a user selects the item <strong>B</strong> . When
selected, the camera moves from its current viewpoint to the chosen
item. The position of the camera (<strong>C</strong>) is in orbit relative to the
selected item. Basically I used a lookat matrix from the camera position
(<strong>C</strong>) to the target item. To create the camera motion when moving from
one item to another, I interpolated the target position (<strong>from A to
B</strong>) and generated a rotation around this interpolated point (<strong>X</strong>)
during the animation. I added some constraints like the distance from
the target point and some limits in the rotation to keep the camera
position in range (like if we would see the item from a 3rd person).
Check out this <a href="demo/ff4demo/demo3/demo.html">experiment</a>
(use 'del' key to go to previous level).</p>
<h3>Twitter</h3>
<p>This idea ended up being too geeky, so we tried out something more
popular and surrounded by more hype. And therein was born the idea of
displaying tweets with 3D.
A first try was to iterate on something like tweet deck but we wanted
something that would be more responsive and with eye candy features...
the first ugly <a href="demo/ff4demo/demo2/demo.html">experiment</a>
was to render tweets in a canvas and to use them as texture in 3D. We
ended up dropping this idea and instead decided to show tweets
geo-localized on the earth.</p>
<p>The last idea we had is the current incarnation of the globe tweeter. To
make the globe I used 3 data files from <a href="http://www.naturalearthdata.com/">natural earth
data</a></p>
<ul>
<li><a href="http://showwebgl.com/show/?q=g6lu4j6t5m8scg4s8og0wkwwss0gwk0&amp;LIGHT=0&amp;CULL_FACE=0">110m admin 0
    countries.shp</a>
    contains the polygons of countries</li>
<li><a href="http://showwebgl.com/show/?q=6f68hn2hr8so44csowwc4skkcgg4s8k&amp;LIGHT=0">110m
    coastline.shp</a>
    contains only the coastline (meaning lines around oceans)</li>
<li><a href="http://showwebgl.com/show/?q=fxaeg6xeuvc4so0sgcgkswsgk0sw8g4&amp;LIGHT=0">110m admin 0 boundary lines
    land.shp</a>
    contains the lines inside land boundaries</li>
</ul>
<p>As you can see, those data are flat and need to be projected on a
sphere. Before projecting those data, however, I had to tesselate the
triangles in order to have enough vertex to project a clean shape on the
sphere. For this I have created a tool called 'grid'. It tessellates the
input shape with a grid. It's a kind of boolean union operation.</p>
<p><img alt="" src="media/2011/03/grid.jpg" title="grid" /></p>
<p><img alt="" src="media/2011/03/grid0.jpg" title="grid0" /></p>
<p>Above on the left, you can see the white model that is the original
'110m admin 0 countries.shp'. The black model is the same model but
tesselated a bit more to fit more closely on the sphere. On the right is
the model (grid) use to tessellate the original '110m admin 0
countries.shp'. The idea is to add subdivisions on the height section of
the model.</p>
<p>Once the data is subdivided enough, I created a tool to project each
vertex onto a sphere using the standard <a href="http://en.wikipedia.org/wiki/WGS84">WGS84
projection</a>. <strong>You can see a webgl
version of the projected model by clicking on the picture</strong>.</p>
<p><img alt="" src="media/2011/03/globe-2.jpg" title="globe-2" /></p>
<p><img alt="" src="media/2011/03/globe-1.jpg" title="globe-1" /></p>
<p><img alt="" src="media/2011/03/globe-0.jpg" title="globe-0" /></p>
<p><img alt="" src="media/2011/03/globe-4.jpg" title="globe-4" /></p>
<p>Once the data below were ready we selected a nice color for each model.
On the demo I drew the globe in two passes. The first pass drew back
faces of '110m admin 0 countries' with 'back color' and the second drew
the front faces with 'front color'. It was necessary to have
transparency of the globe because of the blending mode 'One Minus Src
Alpha'.</p>
<p>The Final result looks like this</p>
<p><img alt="" src="media/2011/05/Screenshot-21.jpg" title="Screenshot-21" /></p>
<h3>SceneGraph representation</h3>
<p><img alt="" src="media/2011/04/gt_tree.jpg" title="SceneGraph" /></p>
<h3>Wave</h3>
<p>To add some details about twitter activity I setup a simple wave physics
simulation that produces waves where tweets appear. The algorithm to
produce the waves is explained
<a href="http://freespace.virgin.net/hugo.elias/graphics/x_water.htm">here</a>. To
accomplish this I used two small hidden canvases with a size of 128x64 ,
I used small canvases because the computation is done on javascsipt and
can be expensive. The update of waves was updated every 1/30 seconds.
The update function did the following operations:</p>
<ul>
<li>Convert tweets locations into source wave in the canvas.</li>
<li>Do the physics computation and store the result into the current
    canvas.</li>
<li>Upload the current canvas as texture to use in the vertex shader.
    The vertex shader used this texture as a
    <a href="http://en.wikipedia.org/wiki/Heightmap">heightmap</a>. To understand
    better how the heightmap works you can see
    <a href="http://showwebgl.com/show/?q=7m1vu1clptog8ccs880o0s44cwks000&amp;LIGHT=0">here</a>
    the original model without waves.</li>
</ul>
<p>Vertex Shader</p>
<div class="highlight"><pre><span class="cp">#ifdef GL_ES</span>
<span class="n">precision</span> <span class="n">highp</span> <span class="kt">float</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="n">attribute</span> <span class="n">vec3</span> <span class="n">Vertex</span><span class="p">;</span>
<span class="n">attribute</span> <span class="n">vec3</span> <span class="n">TexCoord0</span><span class="p">;</span>
<span class="n">uniform</span> <span class="n">mat4</span> <span class="n">ModelViewMatrix</span><span class="p">;</span>
<span class="n">uniform</span> <span class="n">mat4</span> <span class="n">ProjectionMatrix</span><span class="p">;</span>
<span class="n">uniform</span> <span class="n">mat4</span> <span class="n">NormalMatrix</span><span class="p">;</span>
<span class="n">uniform</span> <span class="kt">float</span> <span class="n">scale</span><span class="p">;</span>
<span class="n">uniform</span> <span class="n">sampler2D</span> <span class="n">Texture0</span><span class="p">;</span>
<span class="n">varying</span> <span class="kt">float</span> <span class="n">height</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">maxHeight</span> <span class="o">=</span> <span class="mf">1400000.0</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">vec4</span> <span class="n">color</span> <span class="o">=</span> <span class="n">texture2D</span><span class="p">(</span> <span class="n">Texture0</span><span class="p">,</span> <span class="n">TexCoord0</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">Vertex</span><span class="p">);</span>
    <span class="n">vec3</span> <span class="n">normalTransformed</span> <span class="o">=</span> <span class="n">vec3</span><span class="p">(</span><span class="n">NormalMatrix</span> <span class="o">*</span> <span class="n">vec4</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span><span class="mf">0.0</span><span class="p">));</span>
    <span class="kt">float</span> <span class="n">dotComputed</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">normalTransformed</span><span class="p">,</span> <span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
    <span class="n">height</span> <span class="o">*=</span> <span class="n">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">dotComputed</span><span class="p">);</span>
    <span class="n">vec4</span> <span class="n">vrt</span> <span class="o">=</span> <span class="n">vec4</span><span class="p">(</span><span class="n">Vertex</span> <span class="o">+</span>  <span class="n">normal</span> <span class="o">*</span> <span class="p">(</span> <span class="n">height</span> <span class="o">*</span> <span class="n">maxHeight</span> <span class="o">*</span> <span class="n">scale</span><span class="p">),</span><span class="mf">1.0</span><span class="p">);</span>
    <span class="n">gl_Position</span> <span class="o">=</span> <span class="n">ProjectionMatrix</span> <span class="o">*</span> <span class="n">ModelViewMatrix</span> <span class="o">*</span> <span class="n">vrt</span><span class="p">;</span>
    <span class="n">height</span> <span class="o">*=</span> <span class="mf">5.0</span> <span class="o">*</span> <span class="n">scale</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>Fragment Shader</p>
<div class="highlight"><pre><span class="cp">#ifdef GL_ES</span>
<span class="n">precision</span> <span class="n">highp</span> <span class="kt">float</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="n">uniform</span> <span class="n">vec4</span> <span class="n">fragColor</span><span class="p">;</span>
<span class="n">varying</span> <span class="kt">float</span> <span class="n">height</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">gl_FragColor</span> <span class="o">=</span> <span class="n">fragColor</span> <span class="o">*</span> <span class="n">height</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>This shader is applied on a regular grid model projected on the sphere
as explained before but this time the grid has a better resolution. Some
of you will not see the relief of the waves because some webgl
implementation does not expose texture unit on the vertex shader.
Therefore as a work around I made another shader that does not move the
vertexes in the vertex shader. Instead it only changes the color of the
vertexes. You can read more about this issue on the <a href="https://groups.google.com/group/angleproject/browse_thread/thread/fbf08f0ab51ff26d">Angle
project</a>.</p>
<p>Vertex Shader</p>
<div class="highlight"><pre><span class="cp">#ifdef GL_ES</span>
<span class="n">precision</span> <span class="n">highp</span> <span class="kt">float</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="n">attribute</span> <span class="n">vec3</span> <span class="n">Vertex</span><span class="p">;</span>
<span class="n">attribute</span> <span class="n">vec3</span> <span class="n">TexCoord0</span><span class="p">;</span>
<span class="n">uniform</span> <span class="n">mat4</span> <span class="n">ModelViewMatrix</span><span class="p">;</span>
<span class="n">uniform</span> <span class="n">mat4</span> <span class="n">ProjectionMatrix</span><span class="p">;</span>
<span class="n">uniform</span> <span class="n">mat4</span> <span class="n">NormalMatrix</span><span class="p">;</span>
<span class="n">varying</span> <span class="kt">float</span> <span class="n">dotComputed</span><span class="p">;</span>
<span class="n">varying</span> <span class="n">vec2</span> <span class="n">TexCoordFragment</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">TexCoordFragment</span> <span class="o">=</span> <span class="n">TexCoord0</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span>
    <span class="n">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">Vertex</span><span class="p">);</span>
    <span class="n">vec3</span> <span class="n">normalTransformed</span> <span class="o">=</span> <span class="n">vec3</span><span class="p">(</span><span class="n">NormalMatrix</span> <span class="o">*</span> <span class="n">vec4</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span><span class="mf">0.0</span><span class="p">));</span>
    <span class="n">dotComputed</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">dot</span><span class="p">(</span><span class="n">normalTransformed</span><span class="p">,</span> <span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">dotComputed</span> <span class="o">&gt;</span> <span class="mf">0.001</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">dotComputed</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">gl_Position</span> <span class="o">=</span> <span class="n">ProjectionMatrix</span> <span class="o">*</span> <span class="n">ModelViewMatrix</span> <span class="o">*</span> <span class="n">vec4</span><span class="p">(</span><span class="n">Vertex</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>Fragment Shader</p>
<div class="highlight"><pre><span class="cp">#ifdef GL_ES</span>
<span class="n">precision</span> <span class="n">highp</span> <span class="kt">float</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="n">uniform</span> <span class="n">sampler2D</span> <span class="n">Texture0</span><span class="p">;</span>
<span class="n">uniform</span> <span class="n">vec4</span> <span class="n">fragColor</span><span class="p">;</span>
<span class="n">uniform</span> <span class="kt">float</span> <span class="n">scale</span><span class="p">;</span>
<span class="n">varying</span> <span class="kt">float</span> <span class="n">dotComputed</span><span class="p">;</span>
<span class="n">varying</span> <span class="n">vec2</span> <span class="n">TexCoordFragment</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">vec4</span> <span class="n">color</span> <span class="o">=</span> <span class="n">texture2D</span><span class="p">(</span> <span class="n">Texture0</span><span class="p">,</span> <span class="n">TexCoordFragment</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>
    <span class="n">gl_FragColor</span> <span class="o">=</span> <span class="n">fragColor</span> <span class="o">*</span> <span class="n">min</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">dotComputed</span> <span class="o">*</span> <span class="n">color</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.999999</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>Yes it's a bit sad, I have seen this issue lately ... :( . As conclusion
this effect works well but it takes too much cpu in javascript/canvas, I
should have tried a different effect that was less cpu intensive. Have a
look at this <a href="http://www.youtube.com/watch?v=ul9cIj7wISE">video</a> if you
can't see the waves's relief.</p>
<h3>Tweets</h3>
<p>Tweets are displayed with the avatar image with simple quad oriented and
positioned on the sphere from latitude/longitude. To add a nice border
around the image I used a blending operation in the canvas with the
following image.</p>
<p><img alt="" src="media/2011/04/tweets.jpg" title="tweets" /></p>
<p>Finally to have a nice animation when a tweet appears and disappears, I
used an EaseInQuad function for the color, and EaseOutElastic for the
scale component.</p>
<div class="highlight"><pre><span class="nx">EaseInQuad</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="nx">t</span><span class="o">*</span><span class="nx">t</span><span class="p">);</span> <span class="p">};</span>
<span class="nx">EaseOutElastic</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="o">*</span><span class="nx">t</span><span class="p">)</span> <span class="o">*</span>
                                         <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">((</span><span class="nx">t</span><span class="o">-</span><span class="mf">0.3</span><span class="o">/</span><span class="mf">4.0</span><span class="p">)</span> <span class="o">*</span>
                                         <span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.3</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">;</span> <span class="p">};</span>
</pre></div>


<p>Zooming to the earth made tweet really huge related to the screen. To
prevent this effect I introduced a scale factor that depends on the
camera altitude. The full code to update a tweet looks like this</p>
<div class="highlight"><pre><span class="n">update</span><span class="o">:</span> <span class="kd">function</span><span class="o">(</span><span class="n">node</span><span class="o">,</span> <span class="n">nv</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">var</span> <span class="n">ratio</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="n">var</span> <span class="n">currentTime</span> <span class="o">=</span> <span class="n">nv</span><span class="o">.</span><span class="na">getFrameStamp</span><span class="o">().</span><span class="n">getSimulationTime</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">startTime</span> <span class="o">===</span> <span class="kc">undefined</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">node</span><span class="o">.</span><span class="na">startTime</span> <span class="o">=</span> <span class="n">currentTime</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">duration</span> <span class="o">===</span> <span class="kc">undefined</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">node</span><span class="o">.</span><span class="na">duration</span> <span class="o">=</span> <span class="mf">5.0</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="n">var</span> <span class="n">dt</span> <span class="o">=</span> <span class="n">currentTime</span> <span class="o">-</span> <span class="n">node</span><span class="o">.</span><span class="na">startTime</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">dt</span> <span class="o">&gt;</span> <span class="n">node</span><span class="o">.</span><span class="na">duration</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">node</span><span class="o">.</span><span class="na">setNodeMask</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="k">return</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="n">dt</span><span class="o">/</span><span class="n">node</span><span class="o">.</span><span class="na">duration</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">originalMatrix</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">var</span> <span class="n">scale</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">dt</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">osgAnimation</span><span class="o">.</span><span class="na">EaseOutElastic</span><span class="o">(</span><span class="n">dt</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">scale</span> <span class="o">*=</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">manipulator</span><span class="o">.</span><span class="na">height</span><span class="o">/</span><span class="k">this</span><span class="o">.</span><span class="na">WGS_84_RADIUS_EQUATOR</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">manipulator</span><span class="o">.</span><span class="na">height</span> <span class="o">&gt;</span> <span class="k">this</span><span class="o">.</span><span class="na">limit</span><span class="o">)</span> <span class="o">{</span>
           <span class="n">var</span> <span class="n">limitConst</span> <span class="o">=</span> <span class="mf">0.8</span><span class="o">/(</span><span class="mf">2.5</span><span class="o">*</span><span class="k">this</span><span class="o">.</span><span class="na">WGS_84_RADIUS_EQUATOR</span><span class="o">-</span><span class="k">this</span><span class="o">.</span><span class="na">limit</span><span class="o">);</span>
           <span class="n">var</span> <span class="n">rr</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">manipulator</span><span class="o">.</span><span class="na">height</span><span class="o">-</span><span class="k">this</span><span class="o">.</span><span class="na">limit</span><span class="o">)</span> <span class="o">*</span> <span class="n">limitConst</span><span class="o">;</span>
           <span class="n">scale</span> <span class="o">*=</span> <span class="n">rr</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">var</span> <span class="n">scaleMatrix</span> <span class="o">=</span> <span class="n">osg</span><span class="o">.</span><span class="na">Matrix</span><span class="o">.</span><span class="na">makeScale</span><span class="o">(</span><span class="n">scale</span><span class="o">,</span> <span class="n">scale</span><span class="o">,</span> <span class="n">scale</span><span class="o">);</span>
        <span class="n">node</span><span class="o">.</span><span class="na">setMatrix</span><span class="o">(</span><span class="n">osg</span><span class="o">.</span><span class="na">Matrix</span><span class="o">.</span><span class="na">mult</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">originalMatrix</span><span class="o">,</span> <span class="n">scaleMatrix</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="n">var</span> <span class="n">value</span> <span class="o">=</span> <span class="o">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">osgAnimation</span><span class="o">.</span><span class="na">EaseInQuad</span><span class="o">(</span><span class="n">ratio</span><span class="o">));</span>
    <span class="n">var</span> <span class="n">uniform</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="na">uniform</span><span class="o">;</span>
    <span class="n">var</span> <span class="n">c</span> <span class="o">=</span> <span class="o">[</span><span class="n">value</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="n">value</span><span class="o">];</span>
    <span class="n">uniform</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="n">node</span><span class="o">.</span><span class="na">traverse</span><span class="o">(</span><span class="n">nv</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>


<h3>NodeJS</h3>
<p>The server responsible for sending tweets to the clients is done with
nodejs. I used twitter-node, socket.io, and express modules to build the
server. The code is really short so you can have a look on the server
directly. You can get the server code
<a href="https://github.com/cedricpinson/globetweeter-server/">here</a> and improve
it :) A big hug to proppy who bootstraps the nodejs server \o/</p>
<h3>Stats</h3>
<p>The first graph shows the number of connections per day. There is a big
spike when the news was broadcasted. The second graph shows the number
of connections per day but with a smaller scale and the last graph shows
the cumulated number of connections.</p>
<p><img alt="" src="media/2011/05/stats1.png" title="stats" /></p>
<p><strong>Links</strong></p>
<ul>
<li>video <a href="http://www.youtube.com/watch?v=fWuPWaBbS_o">Firefox 4 3D WebGL Demo -
    GlobeTweeter</a></li>
<li>video <a href="http://www.youtube.com/watch?v=Dw5G0UvWB80">GlobeTweeter--Behind the Making of the
    Demo</a></li>
<li>video <a href="http://www.youtube.com/watch?v=ul9cIj7wISE">GlobeTweeter</a></li>
<li>video <a href="http://www.youtube.com/watch?v=Wo_LlP-VvhY">WebGL globetweeter demo Firefox
    4.0</a></li>
<li><a href="https://mozillademos.org/demos/globetweeter/demo.html">globe tweeter
    demo</a></li>
<li><a href="https://github.com/cedricpinson/globetweeter/">globe tweeter source
    code</a></li>
<li><a href="https://github.com/cedricpinson/globetweeter-server">globe tweeter server source
    code</a></li>
<li><a href="https://github.com/cedricpinson/osgjs">osgjs</a></li>
<li><a href="https://sketchfab.com">sketchfab to convert / display model on the
    web</a></li>
<li><a href="demo/insideglobetweeter/">conf at parisjs#6</a></li>
</ul>
<p>A big thanks to Paul Rouget from Mozilla who made this demo possible and
Guillaume Lecollinet who designed this demo.</p>
  </article>

  <div class="divider"><!-- lines divider --></div>

  <!-- SOCIAL -->
<p class="socials">
    <a href="http://www.facebook.com/sharer/sharer.php?u=./globetweeter-experience.html" class="rounded-icon social fa fa-facebook" target="_blank" title="Share on Facebook"><!-- facebook --></a>
    <a href="http://twitter.com/home?status=./globetweeter-experience.html" class="rounded-icon social fa fa-twitter" target="_blank" title="Share on Twitter"><!-- twitter --></a>
    <a href="https://plus.google.com/share?url=./globetweeter-experience.html" class="rounded-icon social fa fa-google-plus" target="_blank" title="Share on Google+"><!-- google plus --></a>
    <a href="http://pinterest.com/pin/create/link/?url==./globetweeter-experience.html" class="rounded-icon social fa fa-pinterest"  target="_blank" title="Share on Pinterest"><!-- pinterest --></a>
    <a href="http://www.linkedin.com/shareArticle?mini=true&url=./globetweeter-experience.html&title=GlobeTweeter - Experience&summary=&source=" class="rounded-icon social fa fa-linkedin" target="_blank" title="Share on Linkedin"><!-- linkedin --></a>
</p>  

  <!-- TAGS -->
  <p class="fsize16"> Tags:
  </p>

  <hr /><!-- divider -->

        </div>

        <!-- SIDEBAR -->
        <div class="right col-md-3">
          <!-- recent work -->
          <!-- <div class="widget">

                      <h3>Recent Work</h3>

                      <a class="popup-image thumb" href="assets/images/preview/slider/1.jpg">
                          <img src="./theme/img/1x1.png" class="img-responsive" data-src="holder.js/85x85/#888:#555555/auto/" alt="img" />
                      </a>
                      <a class="popup-video thumb" href="http://www.youtube.com/watch?v=kh29_SERH0Y?rel=0">
                          <img src="./theme/img/1x1.png" class="ajax-project img-responsive" data-src="holder.js/85x85/#676767:#555555/auto/" alt="img" />
                      </a>
                      <a class="popup-video thumb" href="http://vimeo.com/23630702">
                          <img src="./theme/img/1x1.png" class="ajax-project img-responsive" data-src="holder.js/85x85/#888:#555555/auto/" alt="img" />
                      </a>

                      <a class="external ajax-project thumb" href="project-external-1.html">
                          <img src="./theme/img/1x1.png" class="ajax-project img-responsive" data-src="holder.js/85x85/#676767:#555555/auto/" alt="img" />
                      </a>
                      <a class="external ajax-project thumb" href="project-external-2.html">
                          <img src="./theme/img/1x1.png" class="ajax-project img-responsive" data-src="holder.js/85x85/#888:#555555/auto/" alt="img" />
                      </a>
                      <a class="external ajax-project thumb" href="project-external-3.html">
                          <img src="./theme/img/1x1.png" class="ajax-project img-responsive" data-src="holder.js/85x85/#676767:#555555/auto/" alt="img" />
                      </a>

                      <div class="clearfix"></div>
                  </div> -->

          <!-- categories -->
          <div class="widget">

            <h3>Categories</h3>

            <ul>
               <li><a class="theme_link" href="./category/about.html"><i class="fa fa-dot-circle-o"></i> About</a>
              </li>
              <li><a class="theme_link" href="./category/blog.html"><i class="fa fa-dot-circle-o"></i> blog</a>
              </li>
            </ul>

          </div>

          <!-- Archives -->
          <div class="widget">

            <h3>Archives</h3>

            <!-- Get all of the articles with their dates -->
            <div class="hidden">
                None
                None
                None
                None
                None
                None
                None
                None
                None
                None
                None
                None
                None
                None
                None
                None
            </div>

            <!-- If the user indicates they prefer a list.-->                <ul class="tree">
                    <li>
                        <span><i class="fa fa-minus-square-o"></i>2012</span>
                        <ul>
                            <li>
                                <span><i class="fa fa-plus-square-o"></i>07</span>
                                <ul>
                                        <li style="display: none;">
                                            <a class="theme_link" href="./webgl-camp.html">
                                            <small>Wed 04 July 2012</small>WebGL Camp</a>
                                        </li>
                                </ul>
                                <span><i class="fa fa-plus-square-o"></i>02</span>
                                <ul>
                                        <li style="display: none;">
                                            <a class="theme_link" href="./nouvelle-vague.html">
                                            <small>Mon 20 February 2012</small>Nouvelle Vague</a>
                                        </li>
                                </ul>
                            </li>
                        </ul>                        <span><i class="fa fa-minus-square-o"></i>2011</span>
                        <ul>
                            <li>
                                <span><i class="fa fa-plus-square-o"></i>12</span>
                                <ul>
                                        <li style="display: none;">
                                            <a class="theme_link" href="./demojs.html">
                                            <small>Tue 27 December 2011</small>DemoJS</a>
                                        </li>
                                </ul>
                                <span><i class="fa fa-plus-square-o"></i>05</span>
                                <ul>
                                        <li style="display: none;">
                                            <a class="theme_link" href="./globetweeter-experience.html">
                                            <small>Tue 03 May 2011</small>GlobeTweeter - Experience</a>
                                        </li>
                                </ul>
                                <span><i class="fa fa-plus-square-o"></i>04</span>
                                <ul>
                                        <li style="display: none;">
                                            <a class="theme_link" href="./parisjs-inside-globetweeter.html">
                                            <small>Wed 27 April 2011</small>ParisJS - Inside GlobeTweeter</a>
                                        </li>
                                        <li style="display: none;">
                                            <a class="theme_link" href="./openscenegraph-tools-for-opengl-es-2-0.html">
                                            <small>Thu 14 April 2011</small>OpenSceneGraph tools for OpenGL es 2.0</a>
                                        </li>
                                        <li style="display: none;">
                                            <a class="theme_link" href="./showwebgl.html">
                                            <small>Mon 04 April 2011</small>ShowWebGL</a>
                                        </li>
                                </ul>
                                <span><i class="fa fa-plus-square-o"></i>03</span>
                                <ul>
                                        <li style="display: none;">
                                            <a class="theme_link" href="./vehicle-editor.html">
                                            <small>Fri 11 March 2011</small>Vehicle Editor</a>
                                        </li>
                                </ul>
                                <span><i class="fa fa-plus-square-o"></i>02</span>
                                <ul>
                                        <li style="display: none;">
                                            <a class="theme_link" href="./stats-js.html">
                                            <small>Tue 15 February 2011</small>stats.js</a>
                                        </li>
                                        <li style="display: none;">
                                            <a class="theme_link" href="./osgjs.html">
                                            <small>Mon 14 February 2011</small>osg.js</a>
                                        </li>
                                </ul>
                                <span><i class="fa fa-plus-square-o"></i>01</span>
                                <ul>
                                        <li style="display: none;">
                                            <a class="theme_link" href="./openscenegraph-beginners-book.html">
                                            <small>Thu 27 January 2011</small>OpenSceneGraph beginners book</a>
                                        </li>
                                </ul>
                            </li>
                        </ul>                        <span><i class="fa fa-minus-square-o"></i>2010</span>
                        <ul>
                            <li>
                                <span><i class="fa fa-plus-square-o"></i>08</span>
                                <ul>
                                        <li style="display: none;">
                                            <a class="theme_link" href="./webgl-particles.html">
                                            <small>Tue 17 August 2010</small>WebGL Particles</a>
                                        </li>
                                </ul>
                                <span><i class="fa fa-plus-square-o"></i>07</span>
                                <ul>
                                        <li style="display: none;">
                                            <a class="theme_link" href="./artgame-weekend.html">
                                            <small>Mon 05 July 2010</small>ArtGame Weekend</a>
                                        </li>
                                </ul>
                                <span><i class="fa fa-plus-square-o"></i>04</span>
                                <ul>
                                        <li style="display: none;">
                                            <a class="theme_link" href="./webgl-openscenegraph.html">
                                            <small>Sat 17 April 2010</small>WebGL OpenSceneGraph</a>
                                        </li>
                                </ul>
                                <span><i class="fa fa-plus-square-o"></i>02</span>
                                <ul>
                                        <li style="display: none;">
                                            <a class="theme_link" href="./global-game-jam-2010.html">
                                            <small>Mon 01 February 2010</small>Global Game Jam 2010</a>
                                        </li>
                                </ul>
                            </li>
                        </ul>                        <span><i class="fa fa-minus-square-o"></i>2009</span>
                        <ul>
                            <li>
                                <span><i class="fa fa-plus-square-o"></i>12</span>
                                <ul>
                                        <li style="display: none;">
                                            <a class="theme_link" href="./about.html">
                                            <small>Sun 06 December 2009</small>About</a>
                                        </li>
                                </ul>
                            </li>
                        </ul></li>
                </ul></div>

        </div>
        <!-- /SIDEBAR -->

      </div>

    </article>
  </section>
  <!-- /BLOG -->

<!-- FOOTER -->
<footer>

  <!-- SCROOL TO TOP -->
  <a href="#toTop" class="fa fa-arrow-up toTop"></a>

  <div class="container">

    <div class="row">

        <div class="col-md-6 copyright">
            cedricpinson
            <br />2015 &copy; All Rights Reserved.
        </div>

        <div class="col-md-6 text-right">
              <a href="https://github.com/cedricpinson/" class="social fa fa-github" target="_blank"></a>
              <a href="https://twitter.com/trigrou" class="social fa fa-twitter-square" target="_blank"></a>
              <a href="https://fr.linkedin.com/in/cedricpinson" class="social fa fa-linkedin" target="_blank"></a>
              <a href="mailto:trigrou@gmail.com" class="social fa fa-envelope" target="_blank"></a>
        </div>

    </div>

  </div>
</footer>
<!-- /FOOTER -->



<!-- CORE FILES -->
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script type="text/javascript" src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="./theme/js/jquery.isotope.js"></script>
<script type="text/javascript" src="./theme/js/masonry.js"></script>

<!-- PLUGINS -->
<script type="text/javascript" src="./theme/js/jquery.fitvids.min.js"></script>
<script type="text/javascript" src="./theme/js/jquery.appear.js"></script>
<script type="text/javascript" src="./theme/js/jquery.superslides.min.js"></script>
<script type="text/javascript" src="./theme/js/owl.carousel.min.js"></script>
<script type="text/javascript" src="./theme/js/jquery.carouFredSel-6.2.1-packed.js"></script>
<script type="text/javascript" src="./theme/js/jquery.countTo.js"></script>
<script type="text/javascript" src="./theme/js/jquery.magnific-popup.min.js"></script>
<script type="text/javascript" src="./theme/js/holder.js"></script>
<!-- delete on production -->

<!-- js scripts -->
<script async type="text/javascript" src="./theme/js/scripts.js"></script>

<script type="text/javascript" src="./theme/js/ImageAutoResize.js"></script>
<script type="text/javascript" src="./theme/js/application.js"></script>





</body>

</html>